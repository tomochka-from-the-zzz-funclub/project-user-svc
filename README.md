# User Service

## Описание

Это Python-приложение, реализованное в соответствии с принципами **Чистой архитектуры**. Проект предназначен для микросервисной архитектуры и использует следующие технологии:

- **FastAPI** для разработки веб-API.
- **gRPC** для высокопроизводительного межсервисного взаимодействия.
- **Kafka** для обмена сообщениями между сервисами.
- **PostgreSQL** для хранения данных.
- **Redis** для ускорения доступа к часто используемым данным.

## Структура проекта

```bash
user-svc/
├── domain/
│   ├── models/
│   └── repositories/
├── use_cases/
├── infrastructure/
│   ├── grpc/
│   ├── kafka/
│   ├── db/
│   └── cache/
├── interfaces/
│   ├── grpc/
│   └── kafka/
├── tests/
├── configs/
└── scripts/
```

### Описание директорий

- **domain/**
  - **models/**: Доменные модели приложения.
  - **repositories/**: Интерфейсы и реализации доступа к данным.
- **use_cases/**: Бизнес-логика и сценарии использования.
- **infrastructure/**
  - **grpc/**: Реализация gRPC-сервера и клиента.
  - **kafka/**: Интеграция с Apache Kafka.
  - **db/**: Доступ к базе данных (ORM, миграции).
  - **cache/**: Механизмы кэширования (например, Redis).
- **interfaces/**
  - **grpc/**: Интерфейсы для gRPC.
  - **kafka/**: Интерфейсы для Kafka.
- **tests/**: Модульные и интеграционные тесты.
- **configs/**: Файлы конфигурации приложения.
- **scripts/**: Скрипты для запуска и обслуживания приложения.

## Начало работы

### Предварительные требования

- **Python 3.8+**
- **uv** (улучшенный менеджер пакетов) или **pip** (базовый менеджер пакетов)
```bash
# On macOS and Linux.
$ curl -LsSf https://astral.sh/uv/install.sh | sh

# On Windows.
$ powershell -c "irm https://astral.sh/uv/install.ps1 | iex"

# With pip.
$ pip install uv
```

### Установка

1. **Клонирование репозитория**

   ```bash
   git clone https://github.com/1ommyS/dreamteam-user-svc
   cd dreamteam-user-svc
   ```

2. **Создание и активация виртуального окружения**

   ```bash
   python3 -m venv venv
   source venv/bin/activate  # Для Unix/MacOS
   # venv\Scripts\activate   # Для Windows
   ```


### Конфигурация

Отредактируйте файлы конфигурации в директории `configs/` в соответствии с вашими настройками окружения (БД, Kafka, Redis и т.д.).

## Запуск приложения

### Запуск FastAPI сервера

1. **Перейдите в корневую директорию проекта**

   ```bash
   cd user-svc
   ```

2. **Запустите сервер**

   ```bash
   uv run fastapi dev
   ```

   > **Примечание:** Предполагается, что файл `main.py` с экземпляром приложения FastAPI находится в корневой директории и называется `main.py`.

3. **Доступ к API**

   API будет доступен по адресу: [http://localhost:8000](http://localhost:8000)

4. **Документация API**

   Документация автоматически генерируется и доступна по адресу: [http://localhost:8000/docs](http://localhost:8000/docs)

### Запуск gRPC сервера

1. **Перейдите в директорию gRPC**

   ```bash
   cd infrastructure/grpc
   ```

2. **Запустите gRPC сервер**

   ```bash
   uv run server.py
   ```

## Тестирование

Запустите все тесты с помощью PyTest:

```bash
uv run pytest tests
```

## Скрипты

В директории `scripts/` находятся полезные скрипты для управления приложением, например, запуск миграций, заполнение базы данных тестовыми данными и т.д.

## Развертывание

Инструкции по развертыванию приложения в различных средах (Docker, Kubernetes, облачные платформы) находятся в документации в директории `docs/` или в соответствующих скриптах в `scripts/`.

## Дополнительная информация

- **Kafka**

  Убедитесь, что Kafka запущена и доступна по адресу, указанному в конфигурационных файлах.

- **База данных**

  Проверьте параметры подключения к базе данных в `configs/db_config.yaml` и убедитесь, что база данных настроена правильно.

- **Redis**

  Настройки подключения к Redis находятся в `configs/cache_config.yaml`


**Спасибо за использование нашего приложения!**
